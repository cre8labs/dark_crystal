(function(){"use strict";!function(){var a;return null!=(a=Array.prototype).shuffle?(a=Array.prototype).shuffle:a.shuffle=function(){var a,b,c,d,e;for(a=c=d=this.length-1;1>=d?1>=c:c>=1;a=1>=d?++c:--c)b=Math.floor(Math.random()*(a+1)),e=[this[b],this[a]],this[a]=e[0],this[b]=e[1];return this}}(),angular.module("darkCrystalApp",["ui.bootstrap","ngResource","ngRoute","ngAnimate","ngTouch"]).config(["$routeProvider",function(a){return a.when("/",{redirectTo:"/players"}).when("/about",{templateUrl:"views/about.html"}).when("/contact",{templateUrl:"views/contact.html"}).when("/players",{templateUrl:"views/players.html",controller:"PlayersCtrl",resolve:{elements:["MultiElementLoader",function(a){return a()}]}}).when("/board",{templateUrl:"views/board.html",controller:"BoardCtrl"}).when("/game",{templateUrl:"views/game.html",controller:"GameCtrl"}).otherwise({redirectTo:"/players"})}])}).call(this),function(){"use strict";angular.module("darkCrystalApp").controller("TopNavCtrl",["$scope","$location",function(a,b){return a.navTo=function(a){return b.path(a)}}])}.call(this),function(){"use strict";angular.module("darkCrystalApp").controller("PlayersCtrl",["$scope","elements","Element","Players",function(a,b,c,d){var e,f,g;return a.myInterval=5e3,g=a.slides=[],e=a.players=d.all(),f=["Adam","Monika","Sam","Martha","Tom"],a.addSlide=function(a){return g.push({image:a.image,text:a.name})},a.addPlayer=function(a){var d;return d=c.get({id:b[a].id}),e.push({name:f.shuffle()[0],element:d,human:!1})},a.removePlayer=function(a){return e.splice(a,1)},b.map(a.addSlide)}])}.call(this),function(){"use strict";angular.module("darkCrystalApp").service("Players",function(){return{players:[],add:function(a){return this.players.push(a)},all:function(){return this.players}}})}.call(this),function(){"use strict";angular.module("darkCrystalApp").factory("Element",["$resource",function(a){return a("resources/data/elements/:id.json",{},{query:{method:"GET",params:{id:"elements"},isArray:!0}})}])}.call(this),function(){"use strict";angular.module("darkCrystalApp").controller("BoardCtrl",["$scope","Board",function(a,b){return a.numberOfFields=b.fields.length>0?b.fields.length:35,a.generate=function(){return b.generate(a.numberOfFields)},0===b.fields.length?a.generate():void 0}])}.call(this),function(){"use strict";angular.module("darkCrystalApp").service("Board",[function(){var a;return a=[{title:"Road",moveRange:[1,6],image:"resources/fields/road.png"},{title:"Plain",moveRange:[1,5],image:"resources/fields/plain.png"},{title:"Mountain",moveRange:[1,3],image:"resources/fields/mountain.png"},{title:"Forest",moveRange:[1,4],image:"resources/fields/forest.png"},{title:"Swamp",moveRange:[1,2],image:"resources/fields/swamp.png"},{title:"River",moveRange:[1,3],image:"resources/fields/river.png"},{title:"River-Whirlpool",moveRange:[1,2],image:"resources/fields/river_whirlpool.png"},{title:"River-Whaterfall",moveRange:[1,2],image:"resources/fields/river_waterfall.png"},{title:"Desert",moveRange:[1,2],image:"resources/fields/desert.png"},{title:"Desert-Storm",moveRange:[1,2],image:"resources/fields/desert_storm.png"},{title:"Desert-Skylights",moveRange:[1,2],image:"resources/fields/swamp_skylights.png"},{title:"Swamp-Fog",moveRange:[1,2],image:"resources/fields/swamp_fog.png"},{title:"Mountain-Avalanche",moveRange:[1,2],image:"resources/fields/mountain_avalanche.png"},{title:"Mountain-Precipice",moveRange:[1,2],image:"resources/fields/mountain_precipice.png"},{title:"Desert-Quicksand",moveRange:[1,2],image:"resources/fields/desert_quicksand.png"},{title:"Volcano",moveRange:[1,2],image:"resources/fields/volcano.png"},{title:"Volcano-Lava",moveRange:[1,2],image:"resources/fields/volcano_lava.png"},{title:"Volcano-Sulfur",moveRange:[1,2],image:"resources/fields/volcano_sulfur.png"}],{fields:[],generate:function(b){var c,d,e,f;for(null==b&&(b=35),c=[],d=e=0,f=b-1;f>=0?f>e:e>f;d=f>=0?++e:--e)c.push(angular.extend(angular.copy(a.shuffle()[0]),{index:d}));return c.push({title:"Dark Crystal",image:"resources/fields/dark_crystal.png"}),this.fields=c}}}])}.call(this),function(){"use strict";angular.module("darkCrystalApp").factory("MultiElementLoader",["Element","$q",function(a,b){return function(){var c;return c=b.defer(),a.query(function(a){return c.resolve(a)},function(){return c.reject("Unable to fetch Elements")}),c.promise}}])}.call(this),function(){"use strict";angular.module("darkCrystalApp").controller("GameCtrl",["$scope","Board","Players",function(a,b,c){return a.fields=b.fields,a.players=c.all()}])}.call(this),function(){"use strict";angular.module("darkCrystalApp").service("Game",["Players","Board",function(){var a;return a={preparation:[]},{current_phase:null}}])}.call(this),function(){"use strict";angular.module("darkCrystalApp").directive("board",["Board",function(a){return{template:'<ul class="board">\n  <field ng-repeat="field in fields" data-field-index="{{ field.id }}" style="background-image: url({{ field.image }});">\n    <span class="badge badge-inverse pull-right">{{ $index +1 }}</span>\n  </field>\n</ul>',restrict:"E",replace:!0,scope:{},controller:["$scope","$element",function(b){return b.Board=a,b.fields=a.fields,b.$watch("Board.fields",function(a){return b.fields=a})}],link:function(){}}}])}.call(this),function(){"use strict";angular.module("darkCrystalApp").directive("field",[function(){return{require:"^board",template:"<li ng-transclude></li>",restrict:"E",replace:!0,transclude:!0,link:function(){}}}])}.call(this),function(a,b){function c(b,c){this.options=a.extend({},e,c),this.$el=a(b),this._defaults=e,this._name=d,this._state=0,this._$dice=null,this._c=0,this._timer=null,this._rolling_is_on=!1,this.init()}var d="rollingDice",e=(b.document,{turningCounts:15,defaultResult:1});c.prototype.init=function(){this._generateMarkup()},c.prototype._generateMarkup=function(){var b=this;b._$dice=a('<div class="dice"></div>'),b.$el.append(b._$dice)},c.prototype._rollOnce=function(a,b){var c=this,d=c._$dice,e=Math.floor(6*Math.random()),f=Math.floor(3*Math.random()),g=-(45+90*e),h=-(315+90*f),i=g+"px "+h+"px",j={"background-position":i},k=c.options.turningCounts;b&&(k=b),d.css(j),c._c++,c._c<k?setTimeout(function(){c._rollOnce(a,k)},50):(c._state=0,c._c=0,c.showNumber(a),c.$el.trigger({type:"rolled",num:a}))},c.prototype._roll=function(){var a=this,b=a._$dice,c=Math.floor(6*Math.random()),d=Math.floor(3*Math.random()),e=-(45+90*c),f=-(315+90*d),g=e+"px "+f+"px",h={"background-position":g};b.css(h),a._rolling_is_on&&(a._timer=setTimeout(function(){a._roll()},50))},c.prototype.showNumber=function(a){var b=this,c=b._$dice,d=a-1,e=Math.floor(3*Math.random()),f=-(45+90*d),g=-(45+90*e),h=f+"px "+g+"px ",i={"background-position":h};c.css(i),b.currentVal=a},c.prototype.rollDiceToNum=function(a,b){var c=this;c._state||(c._state=1,c.$el.trigger({type:"rolling"}),c._state=1,c.c=0,"undefined"!=typeof b&&b?c._rollOnce(a,b):c._rollOnce(a,null))},c.prototype.rollDiceRandom=function(a){var b=Math.floor(6*Math.random())+1;this.rollDiceToNum(b,a)},c.prototype.justRoll=function(){var a=this;a._state||(a._state=1,a.$el.trigger({type:"rolling"}),a._rolling_is_on=!0,a._roll())},c.prototype.stopAndShowNumber=function(a){var b=this;if(b._state){var c=Math.floor(6*Math.random())+1;a&&(c=a),b._rolling_is_on=!1,clearTimeout(b._timer),b._timer=null,b._state=0,b.showNumber(c),b.$el.trigger({type:"rolled",num:c})}},c.prototype.getState=function(){return this._state},c.prototype.reset=function(){},a.fn.rollingDice=function(b){return a(this).each(function(){var d=a(this);if(!d.data("rollingDice")){var e=new c(this,b);d.data("rollingDice",e)}})}}(jQuery,window),function(){"use strict";angular.module("darkCrystalApp").directive("dice",["$rootScope",function(a){return{restrict:"A",link:function(b,c){return b.dice=window.dice=$(c).rollingDice({turningCounts:20,defaultResult:5}).on("rolling",function(){return console.log("rolling...")}).on("rolled",function(a){return alert("Rolled: "+a.num)}).data("rollingDice"),a.$on("dice.roll",function(){return b.dice.rollDiceRandom()})}}}])}.call(this),function(){"use strict";angular.module("darkCrystalApp").controller("DiceCtrl",["$rootScope","$scope",function(a,b){return b.roll=function(){return a.$emit("dice.roll")}}])}.call(this);